#!/bin/sh

pgrep -x sxhkd > /dev/null || sxhkd &
pgrep -x picom > /dev/null || picom -f --daemon --config "$HOME/.config/picom/picom.conf" &
# pgrep -x polybar > /dev/null || $HOME/.config/polybar/yuki/launch.sh &
pgrep -x dunst > /dev/null || dunst &
ps aux | grep ~/.config/wallpapers/script.sh | grep -v grep | awk '{print $2}' | xargs -I % kill -9 %
~/.config/wallpapers/script.sh 15 & # rotate wallpaper every 15min
xsetroot -cursor_name left_ptr

killall eww
# screen arg is necessary for workspace script to work 
eww open bar --screen {{ computer_type[computer]['monitors'][0]['name'] }} --arg type=complex &
{% if computer == "workstation" %}
{% for monitor in computer_type[computer]['monitors']%}
{% if monitor['position'] == "left" %}
eww open bar --screen {{ monitor['name'] }} --arg type=simple &
{% endif %}
{% if monitor['position'] == "right" %}
eww open bar --screen {{ monitor['name'] }} --arg type=simple &
{% endif %}
{% endfor %}
{% endif %}

# bspc query -M --names
{% for monitor in computer_type[computer]['monitors'] %}
bspc config -m {{ monitor['name'] }} top_padding {{ monitor['top_padding'] }} 
{% endfor %}

# setup monocle layout by default
{% for monitor in computer_type[computer]['monitors'] %}
DESKTOP="{{ monitor['desktops'] }}"
bspc monitor {{ monitor['name'] }} -d $DESKTOP
for workspace in $DESKTOP; do bspc desktop $workspace --layout monocle; done 
{% endfor %}

bspc config pointer_motion_interval {{ computer_type[computer]['min_refresh_rate'] }}
bspc config border_width         2
bspc config window_gap          10

bspc config split_ratio          0.52
bspc config borderless_monocle   true
bspc config gapless_monocle      true
bspc config pointer_motion_interval 5

# cleanup rules
for rule in $(bspc rule -l | cut -d">" -f1 | sed 's/.$//'); do bspc rule -r $rule; done
# define rules
if [ ! -e /tmp/startup_completed ]; then
    # get names: xprop | grep WM_CLASS -> 2nd string
    bspc rule -a kitty desktop="I" follow=off focus=off -o
    sleep 0.25
    kitty &
    sleep 0.1
    bspc rule -a Code desktop="II" follow=off focus=off state=monocle -o 
    sleep 0.25
    code &
    sleep 0.1
    bspc rule -a Google-chrome desktop="III" follow=off focus=off state=monocle -o
    sleep 0.25
    google-chrome &
    sleep 0.1
    touch /tmp/startup_completed
fi

bspc rule -a Code focus=on state=monocle
bspc rule -a Google-chrome focus=on state=monocle